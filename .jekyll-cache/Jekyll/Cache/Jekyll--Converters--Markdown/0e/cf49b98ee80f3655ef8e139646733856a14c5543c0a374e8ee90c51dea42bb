I""<h2 id="what-we-are-about-to-learn">What we are about to learn</h2>
<p>In This blog we will Learn how to Create a Test class for the Platform Event logic with valid unit testing.</p>

<h2 id="overview">Overview</h2>
<p>Platform Events are cool, fast, easy and optimized way to build an Integration between two sources with a real time sync. Platform events are easy to setup and publish as we discussed in our previous <a href="/Salesforce-spices/Setup-SF-PE-intro/">blog</a>.</p>

<p>Test class are compulsory in Salesforce with atleast 75% of code coverage but along with Code coverage an ideal class should have proper unit testing with System asserts for the performed logic in the main class.</p>

<p>Creating Test classes for Platform Events can be pain because Test classes cannot subscribe to the Platform Events till now so you never know if events are published successfully. In the below part we will see how to test out that if your Platform events are published successfully or stopped due to some error.</p>

<h3 id="main-class">Main Class</h3>

<pre><code class="language-Java">public without sharing class PublishEventsClass {
    
    @TestVisible private static Integer successPublishCount; //This variable will keep the Successful Events number

    public static void publishAccountDetails( List&lt;Account&gt; newAccounts ){
        List&lt;event__e&gt; eventsToPublish = new List&lt;event__e&gt;();
        for( Account acct : newAccounts ){
            eventsToPublish.add( new event__e( Name = acct.Name, website__c = acct.Website ) ); //Creating Events to Publish
        }

        if(!eventsToPublish.isEmpty()){
            List&lt;Database.SaveResult&gt; results = EventBus.publish(eventsToPublish); 
            successPublishCount = 0;
            for (Database.SaveResult sr : results) {
                if (sr.isSuccess()) {
                    System.debug('Successfully published event.');
                    successPublishCount += 1; //Increment for each successful event
                } else {
                    if( sr.getErrors().size() &gt; 0 ){
                        System.debug('Error::'+sr.getErrors().size());
                    }
                }
            }
        }
    }
}
</code></pre>

<h3 id="test-class-for-the-above-class">Test Class For The Above Class</h3>

<pre><code class="language-Java">@isTest
private without sharing class PublishEventsClassTest{
    
    @isTest
    public static void testMethodEx() {
        List&lt;Account&gt; accounts = new List&lt;Account&gt;();
        for( Integer i=0; i&lt;10; i++ ){
            accounts.add( new Account( Name = 'test '+i ) ); //Creating Sample Account records.
        }

        Test.startTest();
        PublishEventsClass.publishAccountDetails( accounts ); //Calling the Publish method with Accounts
        Test.stopTest();

        //Below Assert will check if there are less Successfully published events then the number of Accounts Passed.
        System.assertEquals( accounts.size(), PublishEventsClass.successPublishCount, 'Platform Events not Published Successfully.' );
    }
}
</code></pre>

<p><br /><br />
Above Unit testing method will make the test class fail if there are some issues in Publishing the events. So instead of just getting the code coverage we should always try to test the executed logics in the main class.</p>

<h3 id="related-blogs">Related Blogs</h3>
<p><a href="/Salesforce-spices/Setup-SF-PE-intro/">Introduction to Salesforce Platform Events</a>
<a href="/Salesforce-spices/PE-Tester/">Platform Events Test in Real Time</a></p>

<p>Thanks for Reading !!</p>
:ET